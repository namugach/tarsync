# Tarsync - 시스템 백업 및 복구 도구 프로젝트 소개

## 프로젝트 개요

Tarsync는 Linux 시스템을 위한 강력하고 사용하기 쉬운 백업 및 복구 도구입니다. tar와 rsync의 장점을 결합하여 완전한 시스템 보존과 안전한 복구를 제공합니다. 시스템 관리자와 개발자 모두를 위해 설계된 이 도구는 복잡한 백업/복구 과정을 단순화하면서도 전문가 수준의 기능을 제공합니다.

## 주요 특징

### 1. 효율적인 압축 백업 시스템

Tarsync의 핵심은 tar와 gzip을 조합한 효율적인 압축 백업 시스템입니다:

#### 압축 기술
- **스트리밍 압축**: tar로 아카이빙하면서 동시에 gzip으로 압축하는 파이프라인 처리
- **메모리 효율성**: 대용량 데이터도 메모리 사용량을 최소화하여 처리
- **압축률 최적화**: 평균 70-80% 압축률로 저장 공간 효율성 극대화
- **병렬 처리**: CPU 멀티코어를 활용한 병렬 압축으로 성능 향상

#### 진행률 모니터링
- **실시간 진행률**: pv(pipe viewer)를 통한 시각적 진행률 표시
- **전송 속도 표시**: 현재 처리 속도 및 예상 완료 시간 제공
- **데이터량 추적**: 처리된 데이터량과 전체 크기 비교 표시
- **성능 최적화 정보**: 처리 속도를 통한 시스템 성능 분석 가능

### 2. 완전한 시스템 상태 보존

#### 파일 시스템 메타데이터 완전 보존
- **ACL (Access Control Lists)**: 확장 접근 권한 정보 완전 보존
- **확장 속성 (Extended Attributes)**: SELinux 컨텍스트, 사용자 정의 속성 보존
- **하드링크**: 파일 간 하드링크 관계 정확히 복원
- **심볼릭 링크**: 절대/상대 경로 심볼릭 링크 완전 보존
- **파일 권한**: 소유자, 그룹, 권한 비트 정확히 보존
- **타임스탬프**: 수정 시간, 접근 시간, 상태 변경 시간 보존

#### 시스템 설정 보존
- **사용자 계정 정보**: /etc/passwd, /etc/shadow, /etc/group 보존
- **시스템 서비스**: systemd 서비스 설정 및 상태 보존
- **네트워크 설정**: 인터페이스 설정, 라우팅 테이블 보존
- **커널 모듈**: 로드된 모듈 및 설정 보존

### 3. 지능적인 제외 시스템

#### 자동 제외 패턴
Tarsync는 백업에서 제외해야 할 파일들을 지능적으로 판단합니다:

**시스템 가상 파일시스템**:
- `/proc`, `/sys`, `/dev`: 가상 파일시스템 자동 제외
- `/run`, `/tmp`: 임시 파일 및 런타임 파일 제외
- `/mnt`, `/media`: 마운트 포인트 제외로 외부 저장소 문제 방지

**개발 관련 임시 파일**:
- `node_modules`: Node.js 의존성 패키지 제외
- `.cache`, `*.tmp`: 캐시 및 임시 파일 제외
- `*.log`: 로그 파일 선택적 제외 (설정 가능)

#### 커스터마이징 가능한 제외 규칙
- **와일드카드 패턴**: `*.iso`, `*.img` 등 패턴 기반 제외
- **디렉토리 패턴**: `*/Downloads`, `*/Trash` 등 위치 기반 제외
- **크기 기반 제외**: 설정 가능한 최대 파일 크기 제한
- **사용자 정의 규칙**: 프로젝트별 맞춤 제외 규칙 지원

### 4. 안전하고 유연한 복구 시스템

#### 이중 복구 모드
Tarsync는 두 가지 복구 모드를 제공하여 다양한 복구 시나리오에 대응합니다:

**안전 복구 모드 (기본값)**:
- 기존 파일을 보존하면서 백업 내용을 추가/업데이트
- 충돌하는 파일은 백업 버전으로 덮어씀
- 대상 폴더에만 존재하는 파일은 그대로 유지
- 부분 복구나 특정 파일 복구에 적합

**완전 동기화 모드**:
- 백업 시점과 완전히 동일한 상태로 복구
- rsync의 `--delete` 옵션으로 백업에 없는 파일 삭제
- 시스템 전체 복구나 정확한 시점 복구에 적합
- 주의: 데이터 손실 가능성이 있으므로 신중히 사용

#### 복구 안전 장치
- **복구 전 확인**: 복구 방식과 대상을 명확히 확인
- **원본 경로 자동 추출**: 백업 로그에서 원본 경로 자동 제안
- **권한 검증**: 복구 대상 경로 쓰기 권한 사전 확인
- **롤백 지원**: 복구 실패 시 자동 정리 및 상태 복원

### 5. 완전한 메타데이터 관리 시스템

#### 자동 메타데이터 생성
각 백업마다 상세한 메타데이터가 자동으로 생성됩니다:

```bash
# 메타데이터 예시 (meta.sh)
META_VERSION="1.0"
META_SIZE=9123456789              # 원본 데이터 크기
META_BACKUP_SIZE=2156789012       # 압축된 백업 크기  
META_CREATED="2025-01-01_14:30:45"
META_SOURCE="/home"
META_COMPRESSION_RATIO="76.3%"    # 압축률
META_DURATION="00:12:34"          # 소요 시간
META_FILES_COUNT=123456           # 백업된 파일 수
META_EXCLUDE=(...)                # 제외된 경로 목록
```

#### 백업 무결성 검증
- **자동 무결성 검사**: gzip 및 tar 구조 자동 검증
- **상태 표시**: ✅ (정상), ⚠️ (메타데이터 없음), ❌ (파일 손상)
- **크기 검증**: 예상 크기와 실제 크기 비교
- **체크섬 지원**: 향후 버전에서 MD5/SHA256 체크섬 지원 예정

### 6. 사용자 친화적 인터페이스

#### 직관적인 명령어 구조
```bash
# 간단한 명령어로 강력한 기능
./bin/backup                    # 시스템 백업
./bin/list                      # 백업 목록 조회
./bin/restore                   # 백업 복구
```

#### 인터랙티브 사용자 경험
- **메뉴 기반 선택**: 백업 선택, 복구 방식 선택 등
- **자동완성**: bash/zsh 자동완성 지원 (향후 추가 예정)
- **컨텍스트 도움말**: 각 단계별 상세한 안내 메시지
- **오류 복구 가이드**: 문제 발생 시 해결 방법 자동 제안

#### 로그 시스템
- **사용자 편집 가능한 로그**: vim/nano로 백업 로그 편집 가능
- **구조화된 로그 형식**: Markdown 형식의 읽기 쉬운 로그
- **복구 로그**: 모든 복구 작업에 대한 상세 기록
- **성능 통계**: 백업/복구 성능 분석 정보 제공

### 7. 고급 백업 목록 관리

#### 페이지네이션 시스템
- **효율적인 대용량 목록 처리**: 수백 개의 백업도 빠르게 조회
- **유연한 페이지 네비게이션**: 음수 페이지로 마지막부터 조회 가능
- **선택적 로그 표시**: 특정 백업 선택 시 로그 내용 즉시 확인

#### 백업 정보 시각화
```
📦 tarsync 백업 목록
====================
01. ⬜️ ✅ 📖 2.1GB Jan 15 14:30 2025_01_15_오후_02_30_45
02. ⬜️ ✅ ❌ 1.8GB Jan 14 09:15 2025_01_14_오전_09_15_30
03. ✅ ⚠️ 📖 950MB Jan 13 16:22 2025_01_13_오후_04_22_10

🔳 전체 저장소: 15.2GB
🔳 페이지 총합: 4.8GB  
🔳 페이지 1 / 3 (총 15 개 백업)
```

#### 백업 관리 기능
- **개별 백업 삭제**: 안전한 확인 과정을 거친 백업 삭제
- **백업 상세 정보**: 메타데이터, 로그, 파일 목록 상세 확인
- **일괄 정리**: 오래된 백업 자동 정리 (향후 추가 예정)

## 기술적 구현

### 1. 모듈화된 아키텍처

#### 핵심 모듈 구조
```
src/
├── modules/                    # 핵심 기능 모듈
│   ├── backup.sh              # 백업 실행 로직
│   ├── restore.sh             # 복구 실행 로직
│   ├── list.sh                # 목록 관리 로직
│   └── common.sh              # 공통 유틸리티
└── utils/                     # 유틸리티 모듈
    ├── config.sh              # 설정 관리
    ├── validation.sh          # 검증 시스템
    ├── format.sh              # 포맷팅 유틸리티
    ├── log.sh                 # 로깅 시스템
    └── colors.sh              # 색상 시스템
```

#### 모듈 간 의존성 관리
- **명확한 인터페이스**: 각 모듈은 정의된 인터페이스로 통신
- **순환 의존성 방지**: 단방향 의존성 구조로 설계
- **공통 유틸리티 활용**: 중복 코드 제거 및 일관성 확보
- **독립적인 테스트**: 각 모듈을 독립적으로 테스트 가능

### 2. 설정 중심 설계

#### 유연한 설정 시스템
```bash
# config/defaults.sh
BACKUP_DISK="/"                    # 백업 대상
BACKUP_PATH="/workspace/backup"    # 저장 위치
EXCLUDE_PATHS=(...)               # 제외 경로
COMPRESSION_LEVEL=6               # 압축 레벨
```

#### 환경별 설정 지원
- **개발 환경**: 빠른 테스트를 위한 최소 압축
- **운영 환경**: 최적 압축률과 안정성 중심
- **데이터센터**: 대용량 처리 최적화 설정
- **사용자 정의**: 프로젝트별 맞춤 설정

### 3. 오류 처리 및 복구

#### 견고한 오류 처리
- **단계별 검증**: 각 단계마다 전제 조건 확인
- **graceful degradation**: 부분 실패 시에도 안전한 종료
- **자동 복구**: 가능한 경우 자동으로 문제 해결
- **상세 오류 보고**: 문제 진단을 위한 완전한 컨텍스트 제공

#### 백업/복구 안전성
- **원자성 보장**: 백업/복구는 모두 성공하거나 모두 실패
- **롤백 지원**: 실패한 작업의 자동 정리
- **데이터 무결성**: 모든 단계에서 데이터 손상 방지
- **권한 보존**: 원본과 동일한 권한 유지

### 4. 성능 최적화

#### I/O 최적화
- **스트리밍 처리**: 메모리 사용량 최소화
- **파이프라인 처리**: CPU와 I/O 병렬 처리
- **버퍼링 최적화**: 시스템별 최적 버퍼 크기 사용
- **압축 최적화**: CPU 코어 수에 따른 압축 레벨 조정

#### 네트워크 효율성
- **대역폭 최적화**: 네트워크 백업 시 대역폭 효율적 사용
- **재시도 메커니즘**: 네트워크 문제 시 자동 재시도
- **체크포인트**: 대용량 전송 시 중단점 저장
- **압축 우선**: 네트워크 전송 전 압축으로 전송량 최소화

## 사용 사례

### 1. 시스템 관리자

#### 일일 백업 루틴
```bash
# 전체 시스템 백업 (cron 작업)
0 2 * * * /opt/tarsync/bin/backup

# 주간 백업 검증
0 3 * * 0 /opt/tarsync/scripts/verify-backups.sh

# 월간 오래된 백업 정리
0 4 1 * * /opt/tarsync/scripts/cleanup-old-backups.sh
```

#### 재해 복구
- **BMR (Bare Metal Recovery)**: 완전히 새로운 하드웨어에 시스템 복원
- **파일 레벨 복구**: 특정 파일이나 디렉토리만 선택적 복구
- **시점 복구**: 특정 시점으로 시스템 상태 복원
- **부분 복구**: 사용자 데이터만 별도 복구

### 2. 개발자

#### 개발 환경 백업
```bash
# 프로젝트 디렉토리 백업
./bin/backup /home/developer/projects

# 개발 환경 설정 백업
./bin/backup /home/developer/.config

# 특정 프로젝트 복구
./bin/restore 5 /home/developer/recovery
```

#### CI/CD 통합
- **빌드 아티팩트 백업**: 성공한 빌드 결과물 자동 백업
- **데이터베이스 스냅샷**: 테스트 데이터 백업 및 복원
- **환경 복제**: 운영 환경을 개발 환경으로 복제
- **롤백 지원**: 배포 실패 시 이전 버전으로 자동 롤백

### 3. 데이터 센터

#### 대규모 백업 관리
- **다중 서버 백업**: 여러 서버의 백업을 중앙 집중 관리
- **네트워크 백업**: NFS, SSH를 통한 원격 백업
- **스토리지 관리**: 백업 데이터의 효율적인 스토리지 활용
- **모니터링 통합**: 백업 상태를 모니터링 시스템에 연동

#### 컴플라이언스 지원
- **보존 정책**: 법적 요구사항에 따른 백업 보존 기간 관리
- **암호화**: 민감한 데이터의 암호화 백업 (향후 지원)
- **감사 로그**: 모든 백업/복구 작업에 대한 감사 로그
- **접근 제어**: 백업 데이터에 대한 역할 기반 접근 제어

## 향후 개발 계획

### v1.1.0 - 고급 백업 기능
- **증분 백업**: 변경된 파일만 백업하는 증분 백업 지원
- **차등 백업**: 마지막 전체 백업 이후 변경 사항만 백업
- **백업 압축 알고리즘 선택**: gzip, bzip2, xz 등 다양한 압축 지원
- **병렬 백업**: 여러 디렉토리를 동시에 백업하는 병렬 처리

### v1.2.0 - 네트워크 및 보안
- **원격 백업**: SSH, SFTP, FTP를 통한 원격 저장소 백업
- **암호화 지원**: GPG를 이용한 백업 파일 암호화
- **백업 검증**: 체크섬 기반 백업 무결성 검증
- **대역폭 제한**: 네트워크 백업 시 대역폭 사용량 제한

### v1.3.0 - 자동화 및 모니터링
- **백업 스케줄링**: 내장 스케줄러를 통한 자동 백업
- **웹 인터페이스**: 브라우저 기반 백업 관리 인터페이스
- **알림 시스템**: 이메일, SMS를 통한 백업 상태 알림
- **REST API**: 외부 시스템과의 연동을 위한 API 제공

### v2.0.0 - 엔터프라이즈 기능
- **클러스터 지원**: 분산 환경에서의 백업 관리
- **클라우드 통합**: AWS S3, Google Cloud Storage, Azure Blob 연동
- **디디스플리케이션**: 중복 제거를 통한 저장 공간 최적화
- **고가용성**: 백업 시스템의 이중화 및 장애 조치

### v2.1.0 - AI 기반 최적화
- **지능형 백업 정책**: AI를 활용한 최적 백업 주기 자동 결정
- **이상 탐지**: 백업 패턴 분석을 통한 시스템 이상 탐지
- **용량 예측**: 사용 패턴 분석을 통한 저장소 용량 예측
- **자동 최적화**: 시스템 성능에 따른 백업 설정 자동 조정

## 기여 및 커뮤니티

### 개발 참여
- **오픈 소스**: MIT 라이선스 하에 오픈 소스로 공개
- **기여 환영**: 버그 리포트, 기능 제안, 코드 기여 환영
- **문서화**: 사용자 가이드, 개발자 문서 지속 개선
- **테스팅**: 다양한 환경에서의 테스트 및 피드백

### 지원 채널
- **GitHub Issues**: 버그 리포트 및 기능 요청
- **Wiki**: 사용자 가이드 및 FAQ
- **커뮤니티 포럼**: 사용자 간 정보 공유
- **공식 문서**: 지속적인 문서 업데이트

## 결론

Tarsync는 단순히 파일을 압축하고 복원하는 도구를 넘어서, 완전한 시스템 백업 솔루션을 제공합니다. 사용자 친화적인 인터페이스와 강력한 기능을 결합하여, 시스템 관리자부터 개발자까지 모든 사용자가 신뢰할 수 있는 백업 도구가 되었습니다.

모듈화된 설계와 확장 가능한 아키텍처를 통해 향후 다양한 요구사항에 대응할 수 있으며, 지속적인 개발과 커뮤니티 참여를 통해 더욱 발전해 나갈 것입니다.

**Tarsync와 함께 안전하고 효율적인 백업 환경을 구축하세요.**